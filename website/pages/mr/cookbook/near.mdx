---
title: Building Subgraphs on NEAR
---

> ग्राफ नोडमध्ये आणि होस्ट केलेल्या सेवेवर निअर सपोर्ट बीटामध्ये आहे: जवळचे सबग्राफ बनवण्याबाबत कोणतेही प्रश्न असल्यास कृपया near@thegraph.com शी संपर्क साधा!

हे मार्गदर्शक [जवळच्या ब्लॉकचेन](https://docs.near.org/) वर स्मार्ट कॉन्ट्रॅक्ट्स अनुक्रमित करणारे सबग्राफ तयार करण्यासाठी एक परिचय आहे.

## What is NEAR?

[NEAR](https://near.org/) विकेंद्रित अनुप्रयोग तयार करण्यासाठी एक स्मार्ट कॉन्ट्रॅक्ट प्लॅटफॉर्म आहे. अधिक माहितीसाठी [अधिकृत दस्तऐवज](https://docs.near.org/docs/concepts/new-to-near) ला भेट द्या.

## What are NEAR subgraphs?

ग्राफ डेव्हलपरला ब्लॉकचेन इव्हेंट्सवर प्रक्रिया करण्यासाठी आणि परिणामी डेटा ग्राफक्यूएल API द्वारे सहज उपलब्ध करण्यासाठी साधने देतो, जो वैयक्तिकरित्या सबग्राफ म्हणून ओळखला जातो. [ग्राफ नोड](https://github.com/graphprotocol/graph-node) आता जवळच्या इव्हेंटवर प्रक्रिया करण्यास सक्षम आहे, याचा अर्थ असा की NEAR डेव्हलपर आता त्यांचे स्मार्ट करार अनुक्रमित करण्यासाठी सबग्राफ तयार करू शकतात.

सबग्राफ इव्हेंट-आधारित असतात, याचा अर्थ ते ऐकतात आणि नंतर ऑन-चेन इव्हेंटवर प्रक्रिया करतात. सध्या जवळच्या सबग्राफसाठी दोन प्रकारचे हँडलर समर्थित आहेत:

- Block handlers: these are run on every new block
- Receipt handlers: run every time a message is executed at a specified account

[From the NEAR documentation](https://docs.near.org/docs/concepts/transaction#receipt):

> प्रणालीमध्ये पावती ही एकमेव क्रिया करण्यायोग्य वस्तू आहे. जेव्हा आम्ही जवळच्या प्लॅटफॉर्मवर "व्यवहारावर प्रक्रिया करणे" बद्दल बोलतो, तेव्हा याचा अर्थ शेवटी "पावत्या लागू करणे" असा होतो.

## Building a NEAR Subgraph

`@graphprotocol/graph-cli` is a command-line tool for building and deploying subgraphs.

`@graphprotocol/graph-ts` is a library of subgraph-specific types.

NEAR subgraph development requires `graph-cli` above version `0.23.0`, and `graph-ts` above version `0.23.0`.

> Building a NEAR subgraph is very similar to building a subgraph that indexes Ethereum.

There are three aspects of subgraph definition:

**subgraph.yaml:** सबग्राफ मॅनिफेस्ट, स्वारस्य असलेल्या डेटा स्रोतांची व्याख्या आणि त्यावर प्रक्रिया कशी करावी. NEAR डेटा स्रोताचा एक नवीन `प्रकार` आहे.

**schema.graphql:** एक स्कीमा फाइल जी तुमच्या सबग्राफसाठी कोणता डेटा संग्रहित केला जातो आणि GraphQL द्वारे त्याची क्वेरी कशी करावी हे परिभाषित करते. जवळच्या सबग्राफसाठी आवश्यकता [विद्यमान दस्तऐवज](/developing/creating-a-subgraph#the-graphql-schema) द्वारे कव्हर केल्या जातात.

**AssemblyScript मॅपिंग:** [AssemblyScript कोड](/developing/assemblyscript-api) जो इव्हेंट डेटामधून तुमच्या स्कीमामध्ये परिभाषित केलेल्या घटकांमध्ये अनुवादित करतो. NEAR समर्थन NEAR-विशिष्ट डेटा प्रकार आणि नवीन JSON पार्सिंग कार्यक्षमता सादर करते.

सबग्राफ विकासादरम्यान दोन प्रमुख आज्ञा आहेत:

```bash
$ graph codegen # मॅनिफेस्टमध्ये ओळखल्या गेलेल्या स्कीमा फाइलमधून प्रकार व्युत्पन्न करते
$ graph build # असेंबलीस्क्रिप्ट फायलींमधून वेब असेंब्ली तयार करते आणि /बिल्ड फोल्डरमध्ये सर्व सबग्राफ फाइल्स तयार करते
```

### सबग्राफ मॅनिफेस्ट व्याख्या

सबग्राफ मॅनिफेस्ट (`subgraph.yaml`) सबग्राफसाठी डेटा स्रोत, स्वारस्य ट्रिगर आणि त्या ट्रिगर्सना प्रतिसाद म्हणून चालवल्या जाणार्‍या फंक्शन्स ओळखतो. जवळच्या सबग्राफसाठी उदाहरण सबग्राफ मॅनिफेस्टसाठी खाली पहा:

```yaml
specVersion: 0.0.2
schema:
  file: ./src/schema.graphql # link to the schema file
dataSources:
  - kind: near
    network: near-mainnet
    source:
      account: app.good-morning.near # This data source will monitor this account
      startBlock: 10662188 # Required for NEAR
    mapping:
      apiVersion: 0.0.5
      language: wasm/assemblyscript
      blockHandlers:
        - handler: handleNewBlock # the function name in the mapping file
      receiptHandlers:
        - handler: handleReceipt # the function name in the mapping file
      file: ./src/mapping.ts # link to the file with the Assemblyscript mappings
```

- NEAR subgraphs introduce a new `kind` of data source (`near`)
- The `network` should correspond to a network on the hosting Graph Node. On the Hosted Service, NEAR's mainnet is `near-mainnet`, and NEAR's testnet is `near-testnet`
- NEAR डेटा स्रोत पर्यायी `source.account` फील्ड सादर करतात, जो [ शी संबंधित मानवी वाचनीय आयडी आहे. खाते जवळ](https://docs.near.org/docs/concepts/account). हे खाते किंवा उप-खाते असू शकते.
- NEAR डेटा स्रोत पर्यायी पर्यायी `source.accounts` फील्ड सादर करतात, ज्यामध्ये पर्यायी प्रत्यय आणि उपसर्ग असतात. किमान उपसर्ग किंवा प्रत्यय निर्दिष्ट करणे आवश्यक आहे, ते अनुक्रमे मूल्यांच्या सूचीसह सुरू होणाऱ्या किंवा समाप्त होणाऱ्या कोणत्याही खात्याशी जुळतील. खालील उदाहरण जुळेल: `[app|good].*[morning.near|morning.testnet]`. जर फक्त उपसर्ग किंवा प्रत्ययांची यादी आवश्यक असेल तर इतर फील्ड वगळले जाऊ शकते.

```yaml
accounts:
  prefixes:
    - app
    - good
  suffixes:
    - morning.near
    - morning.testnet
```

NEAR data sources support two types of handlers:

- `blockHandlers`: run on every new NEAR block. No `source.account` is required.
- `receiptHandlers`: डेटा स्रोताचा `source.account` प्राप्तकर्ता आहे अशा प्रत्येक पावतीवर चालवा. लक्षात ठेवा की फक्त अचूक जुळण्यांवर प्रक्रिया केली जाते ([उपखाते](https://docs.near.org/docs/concepts/account#subaccounts) स्वतंत्र डेटा स्रोत म्हणून जोडले जाणे आवश्यक आहे).

### स्कीमा व्याख्या

स्कीमा व्याख्या परिणामी सबग्राफ डेटाबेसची रचना आणि संस्थांमधील संबंधांचे वर्णन करते. हे मूळ डेटा स्रोताचे अज्ञेय आहे. सबग्राफ स्कीमा व्याख्या [येथे](/developing/creating-a-subgraph#the-graphql-schema) अधिक तपशील आहेत.

### असेंबलीस्क्रिप्ट मॅपिंग

इव्हेंटवर प्रक्रिया करण्यासाठी हँडलर [AssemblyScript](https://www.assemblyscript.org/) मध्ये लिहिलेले आहेत.

NEAR indexing introduces NEAR-specific data types to the [AssemblyScript API](/developing/assemblyscript-api).

```typescript

class ExecutionOutcome {
      gasBurnt: u64,
      blockHash: Bytes,
      id: Bytes,
      logs: Array<string>,
      receiptIds: Array<Bytes>,
      tokensBurnt: BigInt,
      executorId: string,
  }

class ActionReceipt {
      predecessorId: string,
      receiverId: string,
      id: CryptoHash,
      signerId: string,
      gasPrice: BigInt,
      outputDataReceivers: Array<DataReceiver>,
      inputDataIds: Array<CryptoHash>,
      actions: Array<ActionValue>,
  }

class BlockHeader {
      height: u64,
      prevHeight: u64,// Always zero when version < V3
      epochId: Bytes,
      nextEpochId: Bytes,
      chunksIncluded: u64,
      hash: Bytes,
      prevHash: Bytes,
      timestampNanosec: u64,
      randomValue: Bytes,
      gasPrice: BigInt,
      totalSupply: BigInt,
      latestProtocolVersion: u32,
  }

class ChunkHeader {
      gasUsed: u64,
      gasLimit: u64,
      shardId: u64,
      chunkHash: Bytes,
      prevBlockHash: Bytes,
      balanceBurnt: BigInt,
  }

class Block {
      author: string,
      header: BlockHeader,
      chunks: Array<ChunkHeader>,
  }

class ReceiptWithOutcome {
      outcome: ExecutionOutcome,
      receipt: ActionReceipt,
      block: Block,
  }
```

These types are passed to block & receipt handlers:

- Block handlers will receive a `Block`
- Receipt handlers will receive a `ReceiptWithOutcome`

Otherwise, the rest of the [AssemblyScript API](/developing/assemblyscript-api) is available to NEAR subgraph developers during mapping execution.

This includes a new JSON parsing function - logs on NEAR are frequently emitted as stringified JSONs. A new `json.fromString(...)` function is available as part of the [JSON API](/developing/assemblyscript-api#json-api) to allow developers to easily process these logs.

## Deploying a NEAR Subgraph

Once you have a built subgraph, it is time to deploy it to Graph Node for indexing. NEAR subgraphs can be deployed to any Graph Node `>=v0.26.x` (this version has not yet been tagged & released).

The Graph's Hosted Service currently supports indexing NEAR mainnet and testnet in beta, with the following network names:

- `near-mainnet`
- `near-testnet`

More information on creating and deploying subgraphs on the Hosted Service can be found [here](/deploying/deploying-a-subgraph-to-hosted).

द्रुत प्राइमर म्हणून - पहिली पायरी म्हणजे तुमचा सबग्राफ "तयार" करणे - हे फक्त एकदाच करणे आवश्यक आहे. होस्ट केलेल्या सेवेवर, हे [तुमच्या डॅशबोर्ड](https://thegraph.com/hosted-service/dashboard) वरून केले जाऊ शकते: "सबग्राफ जोडा".

Once your subgraph has been created, you can deploy your subgraph by using the `graph deploy` CLI command:

```sh
$ graph create --node <graph-node-url> subgraph/name # creates a subgraph on a local Graph Node (on the Hosted Service, this is done via the UI)
$ graph deploy --node <graph-node-url> --ipfs https://api.thegraph.com/ipfs/ # uploads the build files to a specified IPFS endpoint, and then deploys the subgraph to a specified Graph Node based on the manifest IPFS hash
```

The node configuration will depend on where the subgraph is being deployed.

### होस्ट केलेली सेवा

```sh
graph deploy --node https://api.thegraph.com/deploy/ --ipfs https://api.thegraph.com/ipfs/ --access-token <your-access-token>
```

### Local Graph Node (based on default configuration)

```sh
graph deploy --node http://localhost:8020/ --ipfs http://localhost:5001
```

Once your subgraph has been deployed, it will be indexed by Graph Node. You can check its progress by querying the subgraph itself:

```graphql
{
  _meta {
    block {
      number
    }
  }
}
```

### Indexing NEAR with a Local Graph Node

Running a Graph Node that indexes NEAR has the following operational requirements:

- NEAR Indexer Framework with Firehose instrumentation
- NEAR Firehose Component(s)
- Graph Node with Firehose endpoint configured

We will provide more information on running the above components soon.

## Querying a NEAR Subgraph

NEAR subgraphs साठी GraphQL एंडपॉइंट विद्यमान API इंटरफेससह स्कीमा व्याख्येद्वारे निर्धारित केला जातो. अधिक माहितीसाठी कृपया [GraphQL API दस्तऐवज](/querying/graphql-api) ला भेट द्या.

## उदाहरणे सबग्राफ

संदर्भासाठी येथे काही उदाहरणे सबग्राफ आहेत:

[NEAR Blocks](https://github.com/graphprotocol/graph-tooling/tree/main/examples/near-blocks)

[NEAR Receipts](https://github.com/graphprotocol/graph-tooling/tree/main/examples/near-receipts)

## FAQ

### How does the beta work?

NEAR सपोर्ट बीटामध्ये आहे, याचा अर्थ असा की API मध्ये बदल होऊ शकतात कारण आम्ही एकत्रीकरण सुधारण्यासाठी काम करत आहोत. कृपया near@thegraph.com वर ईमेल करा जेणेकरुन आम्‍ही तुम्‍हाला जवळचे सबग्राफ तयार करण्‍यात मदत करू शकू आणि तुम्‍हाला नवीनतम घडामोडींबद्दल अद्ययावत ठेवू शकू!

### Can a subgraph index both NEAR and EVM chains?

नाही, सबग्राफ केवळ एका साखळी/नेटवर्कमधील डेटा स्रोतांना समर्थन देऊ शकतो.

### Can subgraphs react to more specific triggers?

सध्या, फक्त ब्लॉक आणि पावती ट्रिगर समर्थित आहेत. आम्ही एका निर्दिष्ट खात्यावर फंक्शन कॉलसाठी ट्रिगर तपासत आहोत. आम्‍हाला इव्‍हेंट ट्रिगरला सपोर्ट करण्‍यात देखील रस आहे, एकदा NEAR ला नेटिव्ह इव्‍हेंट सपोर्ट असेल.

### Will receipt handlers trigger for accounts and their sub-accounts?

एखादे `खाते` निर्दिष्ट केले असल्यास, ते फक्त खाते नावाशी जुळेल. `खाती` फील्ड निर्दिष्ट करून उप-खाती जुळवणे शक्य आहे, उदाहरणार्थ, खाती आणि उप-खाती जुळण्यासाठी निर्दिष्ट केलेल्या `प्रत्यय` आणि `उपसर्ग` सह. खालील सर्व `mintbase1.near` उप-खात्यांशी जुळतील:

```yaml
accounts:
  suffixes:
    - mintbase1.near
```

### Can NEAR subgraphs make view calls to NEAR accounts during mappings?

This is not supported. We are evaluating whether this functionality is required for indexing.

### Can I use data source templates in my NEAR subgraph?

This is not currently supported. We are evaluating whether this functionality is required for indexing.

### Ethereum subgraphs support "pending" and "current" versions, how can I deploy a "pending" version of a NEAR subgraph?

प्रलंबित कार्यक्षमता अद्याप जवळच्या सबग्राफसाठी समर्थित नाही. मध्यंतरी, तुम्ही वेगळ्या "नावाच्या" सबग्राफवर नवीन आवृत्ती उपयोजित करू शकता, आणि नंतर जेव्हा ते चेन हेडसह समक्रमित केले जाते, तेव्हा तुम्ही तुमच्या प्राथमिक "नावाबद्ध" सबग्राफवर पुन्हा तैनात करू शकता, जे समान अंतर्निहित उपयोजन आयडी वापरेल, त्यामुळे मुख्य सबग्राफ त्वरित समक्रमित केला जाईल.

### My question hasn't been answered, where can I get more help building NEAR subgraphs?

जर सबग्राफ डेव्हलपमेंटचा सामान्य प्रश्न असेल तर, बाकीच्या [डेव्हलपर दस्तऐवजीकरण](/cookbook/quick-start) मध्ये बरीच माहिती आहे. अन्यथा कृपया [द ग्राफ प्रोटोकॉल डिस्कॉर्ड](https://discord.gg/vtvv7FP) मध्ये सामील व्हा आणि #जवळच्या चॅनेलवर विचारा किंवा near@thegraph.com वर ईमेल करा.

## References

- [NEAR developer documentation](https://docs.near.org/docs/develop/basics/getting-started)
